AWSTemplateFormatVersion: "2010-09-09"

Description: API Gateway for line-slideshow

Parameters:
  Env:
    Type: String
  LineSlideshowSqsArn:
    Type: String
  ApigwCallingSqsRoleArn:
    Type: String

Resources:
  LineSlideshowApiGateway:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Name: !Sub line-slideshow-apigw-${Env}
      Description: !Sub API Gateway for line-slideshow-${Env}
      Tags:
        - Key: system
          Value: line-slideshow
      EndpointConfiguration:
        Types:
          - REGIONAL
      Body:
        swagger: "2.0"
        info:
          description: "API Gateway for line-slideshow-dev"
          version: "1.0.0"
          title: "line-slideshow-apigw-dev"
        host: "leojboio40.execute-api.ap-northeast-1.amazonaws.com"
        basePath: "/dev"
        schemes:
          - "https"
        paths:
          /:
            post:
              consumes:
                - "application/json"
              parameters:
                - name: "X-Line-Signature"
                  in: "header"
                  required: true
                  type: "string"
              responses:
                "200":
                  description: "200 response"
              x-amazon-apigateway-integration:
                credentials: "arn:aws:iam::935428647279:role/apigw-calling-sqs-role-dev"
                httpMethod: "POST"
                uri: "arn:aws:apigateway:ap-northeast-1:sqs:path/935428647279/arn:aws:sqs:ap-northeast-1:935428647279:line-slideshow-sqs-dev.fifo"
                responses:
                  default:
                    statusCode: "200"
                requestParameters:
                  integration.request.header.Content-Type: "'application/x-www-form-urlencoded'"
                requestTemplates:
                  application/json:
                    "Action=SendMessage&MessageBody=$util.urlEncode($input.body)\n\
                    # #set($inputRoot = $input.path('$'))\n# {\n#   \"body\": \"$util.escapeJavaScript($input.json('$'))\"\
                    \n# }\n"
                passthroughBehavior: "when_no_match"
                type: "aws"
